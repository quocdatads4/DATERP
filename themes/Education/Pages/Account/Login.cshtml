@page
@using Microsoft.AspNetCore.Mvc.Localization
@using Volo.Abp.Account.Localization
@using Volo.Abp.Account.Settings
@using Volo.Abp.Account.Web.Pages.Account
@using Volo.Abp.AspNetCore.Mvc.UI.Theming
@using Volo.Abp.Identity
@using Volo.Abp.Settings
@model Education.Pages.Account.LoginModel
@using Education.Localization
@inject IHtmlLocalizer<EducationResource> L_Edu
@inject IHtmlLocalizer<AccountResource> L
@inject IThemeManager ThemeManager
@inject Volo.Abp.Settings.ISettingProvider SettingProvider

@{
    Layout = ThemeManager.CurrentTheme.GetAccountLayout();
}

@section scripts
{
    <abp-script-bundle name="@typeof(LoginModel).FullName">
        <abp-script src="/_content/Education/js/account/login.js" />
    </abp-script-bundle>
}

@if (Model.ShowRequireMigrateSeedMessage)
{
    <div class="alert alert-danger">
        <h4 class="alert-heading">@L["RequireMigrateSeedTitle"]</h4>
        <p>@L["RequireMigrateSeedMessage"]</p>
    </div>
}

<div class="abp-account-container">
    <link href="/_content/Education/css/account/login.css" rel="stylesheet" />

    <div class="account-module-form card mt-3 shadow-sm rounded">
        <div class="card-body p-5">
            <h4 class="mb-2 text-center" style="font-weight: 800; color: var(--edu-primary);">
                @L_Edu["Login:Title"] <i class="ti ti-hand-stop"></i>
            </h4>
            <p class="text-center text-muted mb-4">@L_Edu["Login:Welcome"]</p>

            @if (await SettingProvider.IsTrueAsync(AccountSettingNames.IsSelfRegistrationEnabled))
            {
                <div class="text-center mb-3">
                    <strong>
                        @L["AreYouANewUser"]
                        <a href="@Url.Page("./Register", new { returnUrl = Model.ReturnUrl, returnUrlHash = Model.ReturnUrlHash })"
                            class="text-decoration-none fw-bold">@L["Register"]</a>
                    </strong>
                </div>
            }

            @if (Model.EnableLocalLogin)
            {
                <form method="post" class="mt-4">
                    <div asp-validation-summary="All" class="text-danger mb-3"></div>

                    <div class="mb-4">
                        <label class="premium-form-label form-label" asp-for="LoginInput.UserNameOrEmailAddress">
                            <i class="ti ti-user"></i> @L_Edu["Login:UserNameOrEmail"]
                        </label>
                        <div class="premium-input-group">
                            <span class="premium-input-icon"><i class="ti ti-mail"></i></span>
                            <input asp-for="LoginInput.UserNameOrEmailAddress" class="premium-input form-control"
                                placeholder="user@example.com" autocomplete="username" autofocus />
                        </div>
                        <span asp-validation-for="LoginInput.UserNameOrEmailAddress" class="text-danger"></span>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="premium-form-label form-label mb-0" asp-for="LoginInput.Password">
                                <i class="ti ti-lock"></i> @L_Edu["Login:Password"]
                            </label>
                            <a href="@Url.Page("./ForgotPassword", new { returnUrl = Model.ReturnUrl, returnUrlHash = Model.ReturnUrlHash })"
                                class="premium-link small">
                                @L["ForgotPassword"]
                            </a>
                        </div>
                        <div class="premium-input-group input-group" id="passwordGroup">
                            <span class="premium-input-icon"><i class="ti ti-key"></i></span>
                            <input asp-for="LoginInput.Password" class="premium-input form-control" type="password"
                                placeholder="@L_Edu["Login:PasswordPlaceholder"]" autocomplete="current-password"
                                maxlength="@IdentityUserConsts.MaxPasswordLength" id="passwordInput" />
                            <button class="btn btn-secondary premium-input-action" type="button"
                                id="PasswordVisibilityButton" aria-label="Toggle password visibility">
                                <i class="ti ti-eye-off" id="passwordToggleIcon"></i>
                            </button>
                        </div>
                        <span asp-validation-for="LoginInput.Password" class="text-danger"></span>
                    </div>

                    <abp-row>
                        <abp-column>
                            <abp-input asp-for="LoginInput.RememberMe" class="mb-4" />
                        </abp-column>
                    </abp-row>

                    <div class="d-grid gap-2 mt-4">
                        <abp-button type="submit" button-type="Primary" name="Action" value="Login"
                            class="btn-lg premium-btn">
                            <span class="d-flex align-items-center justify-content-center gap-2">
                                @L["Login"] <i class="ti ti-arrow-right"></i>
                            </span>
                        </abp-button>
                        @if (Model.ShowCancelButton)
                        {
                            <abp-button type="submit" button-type="Secondary" formnovalidate="formnovalidate" name="Action"
                                value="Cancel" class="btn-lg mt-2">
                                @L["Cancel"]
                            </abp-button>
                        }
                    </div>
                </form>
            }

            @if (Model.VisibleExternalProviders.Any())
            {
                <div class="divider my-4">
                    <div class="divider-text">@L["OrLoginWith"]</div>
                </div>

                <form asp-page="./Login" asp-page-handler="ExternalLogin" asp-route-returnUrl="@Model.ReturnUrl"
                    asp-route-returnUrlHash="@Model.ReturnUrlHash" method="post">
                    <div class="social-login d-flex justify-content-center gap-2">
                        @foreach (var provider in Model.VisibleExternalProviders)
                        {
                            <button type="submit" class="btn btn-primary m-1" name="provider"
                                value="@provider.AuthenticationScheme"
                                title="@L["LogInUsingYourProviderAccount", provider.DisplayName]">
                                <i class="ti ti-brand-@provider.DisplayName.ToLower()"></i> @provider.DisplayName
                            </button>
                        }
                    </div>
                </form>
            }

            @if (!Model.EnableLocalLogin && !Model.VisibleExternalProviders.Any())
            {
                <div class="alert alert-warning">
                    <strong>@L["InvalidLoginRequest"]</strong>
                    @L["ThereAreNoLoginSchemesConfiguredForThisClient"]
                </div>
            }
        </div>
    </div>
</div>