# DATERP - QUY TẮC & HÀNH VI CỐT LÕI (ANTIGRAVITY)

Bạn đang làm việc trên dự án **DATERP**, một nền tảng **ERP Giáo dục & Doanh nghiệp** dựa trên **ABP Framework**.

## 1. Nguyên Tắc Kiến Trúc (Bắt buộc)
-   **Kiến trúc**: Tuân thủ tuyệt đối **ABP Modular Monolith**.
-   **Core System (`src/`)**: Chỉ chứa hạ tầng dùng chung (Hosting, Shared Kernel, Auth). **TUYỆT ĐỐI KHÔNG** chứa logic nghiệp vụ (như quy tắc thi cử, quản lý khóa học) tại đây.
-   **Business Modules (`modules/`)**: TẤT CẢ logic nghiệp vụ phải nằm trong các Module ABP độc lập (ví dụ: `modules/Academic`, `modules/LMS`).
    -   Các module phải được thiết kế để có thể tách rời (microservice-ready).
    -   Giao tiếp giữa các module thông qua **Contracts** (Interfaces/DTOs) và **Events**. Không join bảng database chéo module.
-   **Themes (`themes/`)**: Logic giao diện (UI) thuộc về Theme Modules. `src/DATERP.Web` chỉ là vỏ (shell) để chạy ứng dụng.

## 2. Cấu Trúc Thư Mục
-   `src/`: **Tầng Hạ Tầng (Infrastructure)**.
    -   `DATERP.Domain.Shared`: Enums, Hằng số dùng chung toàn cầu.
    -   `DATERP.HttpApi.Host`: Điểm nhập API chính.
    -   `DATERP.Web`: Ứng dụng Web Host (Shell), không chứa logic UI phức tạp.
-   `modules/`: **Tầng Nghiệp Vụ (Business)**.
    -   `Academic`: Quản lý Lớp học, Lịch học, Học viên, Trung tâm.
    -   `LMS`: Khóa học, Bài giảng, Ghi danh, Tiến độ học tập.
    -   `Examination`: Bài thi, Câu hỏi, Kết quả, Chứng chỉ.
    -   `Finance`, `HR`, `CRM`, `Inventory`, `Reporting`: Các module nghiệp vụ tương ứng.
-   `themes/`: **Tầng Giao Diện (Presentation)**.
    -   `DATERP.Theme.Education`: Theme chính cho giáo dục.

## 3. Công Nghệ & Tiêu Chuẩn
-   **Framework**: .NET 9.0 + ABP Framework (v9.x).
-   **Frontend**: ASP.NET Core MVC (Razor Views) + Thư viện UI chuẩn của ABP.
-   **Database**: SQL Server (Entity Framework Core).
-   **Identity**: ABP Identity Module (Roles: Admin, Teacher, Student, Staff, Accountant).

## 4. Hướng Dẫn Lập Trình (Implementation)

### 4.1. Domain Layer (DDD)
-   **Entities**: PHẢI kế thừa `AggregateRoot<Guid>` hoặc `Entity<Guid>`.
-   **Managers**: Sử dụng `DomainService` cho logic nghiệp vụ phức tạp.
-   **Repository**:
    -   Dùng `IRepository<TEntity, Guid>` cho CRUD chuẩn.
    -   Dùng `IQueryable<TEntity>` trong Domain Service hoặc Custom Repository cho query phức tạp.
    -   **KHÔNG BAO GIỜ** trả về `IQueryable` từ Application Service.

### 4.2. Application Layer
-   **Services**: Kế thừa `ApplicationService`.
-   **DTOs**: Input/Output của API bắt buộc phải là DTO (không dùng Entity).
    -   Input: `Create...Dto`, `Update...Dto`.
    -   Output: `...Dto`.
-   **Validation**: Dùng FluentValidation cho các quy tắc phức tạp.

### 4.3. Database (EF Core)
-   **Migrations**: Luôn chạy `dotnet ef migrations add` trong `src/DATERP.EntityFrameworkCore` (hoặc module tương ứng) khi thay đổi Domain.

### 4.4. Frontend (MVC)
-   **Page Models**: Kế thừa `AbpPageModel`.
-   **JavaScript**: Sử dụng `abp.ajax`, `abp.notify`, `abp.message`.

## 5. Quy Trình Work-flow (SOP)
-   Khi được yêu cầu "Thêm tính năng" (ví dụ: Quản lý học viên):
    1.  Xác định Module phù hợp (ví dụ: `modules/Academic`).
    2.  Nếu module chưa có, hãy khởi tạo cấu trúc thư mục module trước.
    3.  Triển khai theo thứ tự: Domain -> EF Core -> Application -> Web (bên trong module).
    4.  **KHÔNG** thêm code vào `src/DATERP.Application`.

## 6. Hành Vi Của Agent (Bắt buộc)
-   **Ngôn ngữ**: **TIẾNG VIỆT** (Vietnamese) là ngôn ngữ chính trong mọi phản hồi, kế hoạch và tài liệu.
-   **Thái độ**: Chuyên nghiệp, hỗ trợ, mang tính giáo dục.
-   **Kiểm tra chủ động**: Trước khi viết code, hãy kiểm tra xem mình đang ở thư mục module nào.
-   **Cô lập Module**: Giả định rằng các module không thấy DbContext của nhau.
